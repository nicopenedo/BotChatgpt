<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
  <th:block th:replace="~{layout :: layout('Dashboard', 'dashboard', ~{::content})}">
    <th:block th:fragment="content">
      <section class="grid gap-4 sm:grid-cols-2 xl:grid-cols-4">
        <article th:each="kpi : ${kpis}" class="kpi-card">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-slate-500 dark:text-slate-400" th:text="${kpi.label}">PnL Neto</p>
              <p class="mt-2 text-2xl font-semibold text-slate-900 dark:text-white" th:text="${kpi.value}">$12.4K</p>
            </div>
            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-slate-100 text-primary dark:bg-slate-800">
              <span class="text-sm font-semibold" th:text="${kpi.icon}">%</span>
            </div>
          </div>
          <p class="mt-3 flex items-center gap-2 text-sm" th:classappend="${kpi.trend} == 'up' ? ' text-emerald-500' : ' text-red-500'">
            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" th:classappend="${kpi.trend} == 'up' ? '' : ' rotate-180'">
              <path d="M5 10l5-5 5 5H5z" />
            </svg>
            <span th:text="${kpi.trendValue}">+4.5%</span>
            <span class="text-slate-500 dark:text-slate-400" th:text="${kpi.trendLabel}">vs. 30d</span>
          </p>
        </article>
      </section>
      <section class="grid gap-6 lg:grid-cols-5">
        <article class="card lg:col-span-3">
          <div class="card-header">
            <div>
              <h2 class="card-title">Equity curve</h2>
              <p class="card-subtitle">Incluye drawdowns diarios</p>
            </div>
            <div class="rounded-full bg-emerald-500/10 px-3 py-1 text-xs font-semibold text-emerald-600 dark:bg-emerald-500/20 dark:text-emerald-300">
              Live + Shadow
            </div>
          </div>
          <canvas id="equity-chart" class="chart" th:attr="data-chart=${equityChart}"></canvas>
        </article>
        <article class="card lg:col-span-2">
          <div class="card-header">
            <div>
              <h2 class="card-title">PnL diario</h2>
              <p class="card-subtitle">Últimos 30 días</p>
            </div>
          </div>
          <canvas id="pnl-chart" class="chart" th:attr="data-chart=${pnlChart}"></canvas>
        </article>
        <article class="card lg:col-span-2">
          <div class="card-header">
            <div>
              <h2 class="card-title">Heatmap horario</h2>
              <p class="card-subtitle">P&L por hora vs. día</p>
            </div>
          </div>
          <canvas id="heatmap-chart" class="chart" th:attr="data-chart=${heatmapChart}"></canvas>
        </article>
        <article class="card lg:col-span-3">
          <div class="card-header">
            <div>
              <h2 class="card-title">Actividad reciente</h2>
              <p class="card-subtitle">Órdenes, fills y alertas</p>
            </div>
            <a class="text-sm font-medium text-primary" href="#">Ver todo</a>
          </div>
          <div class="overflow-x-auto">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Tipo</th>
                  <th>Bot</th>
                  <th>Detalle</th>
                  <th>Fecha</th>
                  <th>P&L</th>
                </tr>
              </thead>
              <tbody>
                <tr th:each="item : ${recentActivity}">
                  <td>
                    <span class="tag" th:classappend="' ' + ${item.typeClass}" th:text="${item.type}">Fill</span>
                  </td>
                  <td class="font-semibold" th:text="${item.bot}">BTC Swing</td>
                  <td th:text="${item.description}">Compra 0.5 BTC @ 28k</td>
                  <td th:text="${item.timestamp}">12:45</td>
                  <td th:text="${item.pnl}">+120 USDT</td>
                </tr>
              </tbody>
            </table>
          </div>
        </article>
        <article class="card lg:col-span-3">
          <div class="card-header">
            <div>
              <h2 class="card-title">Riesgo &amp; alertas</h2>
              <p class="card-subtitle">Monitoreo continuo</p>
            </div>
          </div>
          <div class="grid gap-4 sm:grid-cols-2">
            <div class="risk-card" th:each="risk : ${riskCards}">
              <p class="text-sm font-medium text-slate-500" th:text="${risk.label}">VaR 95%</p>
              <p class="mt-2 text-lg font-semibold" th:text="${risk.value}">-2.4%</p>
              <p class="mt-1 text-xs text-slate-400" th:text="${risk.caption}">En rango</p>
            </div>
          </div>
        </article>
      </section>
    </th:block>
  </th:block>
</html>
